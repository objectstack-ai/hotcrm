# Case Object Definition
# å·¥å•ç®¡ç† - Service & Customer Success Domain
# Follows @objectstack/spec standard for enterprise CRM

name: Case
label: å·¥å•
labelPlural: å·¥å•
icon: ticket-alt
description: å®¢æˆ·æœåŠ¡å·¥å•å’Œæ”¯æŒè¯·æ±‚ç®¡ç†

# Enable core features
features:
  searchable: true
  trackFieldHistory: true
  enableActivities: true
  enableNotes: true
  enableAttachments: true
  enableEmailToCase: true

# Field Definitions
fields:
  # Basic Information
  - name: CaseNumber
    type: autoNumber
    label: å·¥å•ç¼–å·
    format: CASE-{YYYY}-{0000}
    readonly: true
    searchable: true
    
  - name: Subject
    type: text
    label: ä¸»é¢˜
    required: true
    searchable: true
    length: 255
    
  - name: Description
    type: textarea
    label: é—®é¢˜æè¿°
    required: true
    length: 32000
    searchable: true
    
  - name: Status
    type: select
    label: çŠ¶æ€
    required: true
    defaultValue: New
    options:
      - label: ğŸ†• æ–°å»º
        value: New
      - label: ğŸ“‹ å¾…å¤„ç†
        value: Open
      - label: ğŸ”„ å¤„ç†ä¸­
        value: In Progress
      - label: â¸ï¸ ç­‰å¾…å®¢æˆ·
        value: Waiting on Customer
      - label: â° å‡çº§
        value: Escalated
      - label: âœ… å·²è§£å†³
        value: Resolved
      - label: ğŸ”’ å·²å…³é—­
        value: Closed
        
  - name: Priority
    type: select
    label: ä¼˜å…ˆçº§
    required: true
    defaultValue: Medium
    options:
      - label: ğŸ”´ ç´§æ€¥
        value: Critical
      - label: ğŸŸ  é«˜
        value: High
      - label: ğŸŸ¡ ä¸­
        value: Medium
      - label: ğŸŸ¢ ä½
        value: Low
        
  - name: Type
    type: select
    label: å·¥å•ç±»å‹
    options:
      - label: ğŸ› é—®é¢˜
        value: Problem
      - label: â“ å’¨è¯¢
        value: Question
      - label: ğŸ†˜ æ•…éšœ
        value: Incident
      - label: ğŸ’¡ åŠŸèƒ½è¯·æ±‚
        value: Feature Request
      - label: ğŸ“ åŸ¹è®­
        value: Training
      - label: ğŸ”§ ç»´æŠ¤
        value: Maintenance
      - label: ğŸ“– å…¶ä»–
        value: Other
        
  - name: Origin
    type: select
    label: æ¥æºæ¸ é“
    required: true
    options:
      - label: ğŸ“§ é‚®ä»¶
        value: Email
      - label: ğŸŒ ç½‘é¡µ
        value: Web
      - label: ğŸ“ ç”µè¯
        value: Phone
      - label: ğŸ’¬ å¾®ä¿¡
        value: WeChat
      - label: ğŸ¤– èŠå¤©æœºå™¨äºº
        value: Chat Bot
      - label: ğŸ“± APP
        value: Mobile App
      - label: ğŸ¯ å…¶ä»–
        value: Other
        
  # Related Records
  - name: AccountId
    type: lookup
    label: å®¢æˆ·
    referenceTo: Account
    required: true
    
  - name: ContactId
    type: lookup
    label: è”ç³»äºº
    referenceTo: Contact
    
  - name: ContractId
    type: lookup
    label: å…³è”åˆåŒ
    referenceTo: Contract
    description: æœåŠ¡åˆåŒ
    
  - name: ProductId
    type: lookup
    label: ç›¸å…³äº§å“
    referenceTo: Product
    
  # Assignment
  - name: OwnerId
    type: lookup
    label: è´Ÿè´£äºº
    referenceTo: User
    required: true
    
  - name: AssignedToQueueId
    type: lookup
    label: åˆ†é…é˜Ÿåˆ—
    referenceTo: Queue
    description: æ”¯æŒå›¢é˜Ÿé˜Ÿåˆ—
    
  # SLA Management
  - name: SLALevel
    type: select
    label: SLA çº§åˆ«
    options:
      - label: ğŸ† ç™½é‡‘
        value: Platinum
      - label: ğŸ¥‡ é»„é‡‘
        value: Gold
      - label: ğŸ¥ˆ ç™½é“¶
        value: Silver
      - label: ğŸ¥‰ é’é“œ
        value: Bronze
      - label: ğŸ“‹ æ ‡å‡†
        value: Standard
        
  - name: ResponseDueDate
    type: datetime
    label: å“åº”æˆªæ­¢æ—¶é—´
    readonly: true
    description: æ ¹æ® SLA è‡ªåŠ¨è®¡ç®—
    
  - name: ResolutionDueDate
    type: datetime
    label: è§£å†³æˆªæ­¢æ—¶é—´
    readonly: true
    description: æ ¹æ® SLA è‡ªåŠ¨è®¡ç®—
    
  - name: FirstResponseTime
    type: datetime
    label: é¦–æ¬¡å“åº”æ—¶é—´
    readonly: true
    
  - name: ActualResolutionTime
    type: datetime
    label: å®é™…è§£å†³æ—¶é—´
    readonly: true
    
  - name: ResponseTimeMinutes
    type: number
    label: å“åº”æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    precision: 0
    readonly: true
    
  - name: ResolutionTimeMinutes
    type: number
    label: è§£å†³æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    precision: 0
    readonly: true
    
  - name: IsSLAViolated
    type: checkbox
    label: SLA è¿è§„
    readonly: true
    defaultValue: false
    
  # Escalation
  - name: IsEscalated
    type: checkbox
    label: å·²å‡çº§
    defaultValue: false
    
  - name: EscalatedDate
    type: datetime
    label: å‡çº§æ—¶é—´
    readonly: true
    
  - name: EscalatedToId
    type: lookup
    label: å‡çº§è‡³
    referenceTo: User
    
  - name: EscalationReason
    type: textarea
    label: å‡çº§åŸå› 
    length: 2000
    
  # Resolution
  - name: Resolution
    type: textarea
    label: è§£å†³æ–¹æ¡ˆ
    length: 32000
    searchable: true
    
  - name: RootCause
    type: textarea
    label: æ ¹æœ¬åŸå› 
    length: 5000
    
  - name: ResolutionCategory
    type: select
    label: è§£å†³æ–¹æ¡ˆåˆ†ç±»
    options:
      - label: ğŸ’» æŠ€æœ¯æ”¯æŒ
        value: Technical Support
      - label: ğŸ“š äº§å“æŒ‡å¯¼
        value: Product Guidance
      - label: ğŸ”§ é…ç½®ä¿®æ”¹
        value: Configuration Change
      - label: ğŸ› Bug ä¿®å¤
        value: Bug Fix
      - label: ğŸ“¦ äº§å“æ›´æ–°
        value: Product Update
      - label: ğŸ“ åŸ¹è®­
        value: Training
      - label: âŒ æ— éœ€ä¿®å¤
        value: No Fix Needed
      - label: ğŸ¯ å…¶ä»–
        value: Other
        
  # Satisfaction
  - name: CustomerSatisfaction
    type: select
    label: å®¢æˆ·æ»¡æ„åº¦
    readonly: true
    options:
      - label: ğŸ˜„ éå¸¸æ»¡æ„
        value: Very Satisfied
      - label: ğŸ™‚ æ»¡æ„
        value: Satisfied
      - label: ğŸ˜ ä¸€èˆ¬
        value: Neutral
      - label: ğŸ˜Ÿ ä¸æ»¡æ„
        value: Dissatisfied
      - label: ğŸ˜¡ éå¸¸ä¸æ»¡æ„
        value: Very Dissatisfied
        
  - name: SatisfactionScore
    type: number
    label: æ»¡æ„åº¦è¯„åˆ†
    precision: 0
    min: 1
    max: 5
    readonly: true
    
  - name: CustomerFeedback
    type: textarea
    label: å®¢æˆ·åé¦ˆ
    length: 5000
    readonly: true
    
  # AI Enhancement Fields
  - name: AIAutoCategory
    type: select
    label: AI è‡ªåŠ¨åˆ†ç±»
    readonly: true
    options:
      - label: æŠ€æœ¯é—®é¢˜
        value: Technical
      - label: äº§å“å’¨è¯¢
        value: Product
      - label: è´¦åŠ¡é—®é¢˜
        value: Billing
      - label: åŠŸèƒ½å»ºè®®
        value: Feature
      - label: æŠ•è¯‰
        value: Complaint
      - label: å…¶ä»–
        value: Other
        
  - name: AISuggestedAssignee
    type: lookup
    label: AI æ¨èå¤„ç†äºº
    referenceTo: User
    readonly: true
    description: æ ¹æ®å·¥å•å†…å®¹è‡ªåŠ¨æ¨èæœ€åˆé€‚çš„å®¢æœ
    
  - name: AIRelatedKnowledge
    type: text
    label: AI æ¨èçŸ¥è¯†åº“
    readonly: true
    length: 500
    description: ç›¸å…³çŸ¥è¯†åº“æ–‡ç«  ID åˆ—è¡¨
    
  - name: AISuggestedSolution
    type: textarea
    label: AI å»ºè®®è§£å†³æ–¹æ¡ˆ
    readonly: true
    length: 5000
    description: åŸºäºçŸ¥è¯†åº“çš„æ™ºèƒ½è§£å†³æ–¹æ¡ˆå»ºè®®
    
  - name: AISentimentAnalysis
    type: select
    label: AI æƒ…ç»ªåˆ†æ
    readonly: true
    options:
      - label: ğŸ˜Š ç§¯æ
        value: Positive
      - label: ğŸ˜ ä¸­æ€§
        value: Neutral
      - label: ğŸ˜Ÿ æ¶ˆæ
        value: Negative
      - label: ğŸ˜¡ æ„¤æ€’
        value: Angry

# Relationships
relationships:
  - name: CaseComments
    type: hasMany
    object: CaseComment
    foreignKey: CaseId
    label: å·¥å•è¯„è®º
    
  - name: Activities
    type: hasMany
    object: Activity
    foreignKey: WhatId
    label: æ´»åŠ¨è®°å½•

# List Views
listViews:
  - name: AllCases
    label: æ‰€æœ‰å·¥å•
    filters: []
    columns:
      - CaseNumber
      - Subject
      - Account
      - Priority
      - Status
      - Owner
      - CreatedDate
    sortBy: CreatedDate
    sortOrder: desc
    
  - name: MyCases
    label: æˆ‘çš„å·¥å•
    filters:
      - field: OwnerId
        operator: equals
        value: $CurrentUser.Id
      - field: Status
        operator: notIn
        value: [Closed]
    columns:
      - CaseNumber
      - Subject
      - Account
      - Priority
      - Status
      - ResolutionDueDate
    sortBy: Priority
    sortOrder: desc
    
  - name: OpenCases
    label: æœªå…³é—­
    filters:
      - field: Status
        operator: notIn
        value: [Closed, Resolved]
    columns:
      - CaseNumber
      - Subject
      - Account
      - Priority
      - Status
      - Owner
      - CreatedDate
    sortBy: CreatedDate
    sortOrder: asc
    
  - name: HighPriority
    label: é«˜ä¼˜å…ˆçº§
    filters:
      - field: Priority
        operator: in
        value: [Critical, High]
      - field: Status
        operator: notIn
        value: [Closed, Resolved]
    columns:
      - CaseNumber
      - Subject
      - Account
      - Priority
      - Status
      - ResolutionDueDate
      - Owner
    sortBy: Priority
    sortOrder: desc
    
  - name: Escalated
    label: å·²å‡çº§
    filters:
      - field: IsEscalated
        operator: equals
        value: true
      - field: Status
        operator: notIn
        value: [Closed, Resolved]
    columns:
      - CaseNumber
      - Subject
      - Account
      - Priority
      - EscalatedDate
      - EscalatedTo
      - Owner
    sortBy: EscalatedDate
    sortOrder: desc
    
  - name: SLAViolations
    label: SLA è¿è§„
    filters:
      - field: IsSLAViolated
        operator: equals
        value: true
    columns:
      - CaseNumber
      - Subject
      - Account
      - SLALevel
      - ResolutionDueDate
      - Owner
    sortBy: ResolutionDueDate
    sortOrder: asc
    
  - name: RecentlyClosed
    label: æœ€è¿‘å…³é—­
    filters:
      - field: Status
        operator: equals
        value: Closed
      - field: ClosedDate
        operator: last_n_days
        value: 30
    columns:
      - CaseNumber
      - Subject
      - Account
      - ResolutionTimeMinutes
      - CustomerSatisfaction
      - ClosedDate
    sortBy: ClosedDate
    sortOrder: desc

# Page Layout
pageLayout:
  sections:
    - label: å·¥å•ä¿¡æ¯
      columns: 2
      fields:
        - CaseNumber
        - Subject
        - Status
        - Priority
        - Type
        - Origin
        
    - label: å…³è”è®°å½•
      columns: 2
      fields:
        - AccountId
        - ContactId
        - ContractId
        - ProductId
        
    - label: åˆ†é…
      columns: 2
      fields:
        - OwnerId
        - AssignedToQueueId
        
    - label: SLA ç®¡ç†
      columns: 2
      fields:
        - SLALevel
        - ResponseDueDate
        - ResolutionDueDate
        - FirstResponseTime
        - ActualResolutionTime
        - ResponseTimeMinutes
        - ResolutionTimeMinutes
        - IsSLAViolated
        
    - label: å‡çº§
      columns: 2
      fields:
        - IsEscalated
        - EscalatedDate
        - EscalatedToId
        - EscalationReason
        
    - label: è§£å†³æ–¹æ¡ˆ
      columns: 1
      fields:
        - Resolution
        - RootCause
        - ResolutionCategory
        
    - label: å®¢æˆ·æ»¡æ„åº¦
      columns: 2
      fields:
        - CustomerSatisfaction
        - SatisfactionScore
        - CustomerFeedback
        
    - label: AI æ™ºèƒ½æ´¾å•
      columns: 1
      fields:
        - AIAutoCategory
        - AISuggestedAssignee
        - AIRelatedKnowledge
        - AISuggestedSolution
        - AISentimentAnalysis
        
    - label: é—®é¢˜æè¿°
      columns: 1
      fields:
        - Description

# Validation Rules
validationRules:
  - name: ResolutionRequiredWhenResolved
    errorMessage: çŠ¶æ€ä¸ºå·²è§£å†³æ—¶å¿…é¡»å¡«å†™è§£å†³æ–¹æ¡ˆ
    formula: |
      AND(
        Status = "Resolved",
        ISBLANK(Resolution)
      )
      
  - name: ClosedCaseReadOnly
    errorMessage: å·²å…³é—­çš„å·¥å•ä¸èƒ½ä¿®æ”¹
    formula: |
      AND(
        PRIORVALUE(Status) = "Closed",
        Status != "Closed"
      )
      
  - name: EscalationReasonRequired
    errorMessage: å‡çº§å·¥å•å¿…é¡»å¡«å†™å‡çº§åŸå› 
    formula: |
      AND(
        IsEscalated = true,
        ISBLANK(EscalationReason)
      )

# Triggers
triggers:
  - name: CaseAutoAssignment
    event: afterInsert
    description: AI æ™ºèƒ½æ´¾å•ï¼Œæ ¹æ®å·¥å•å†…å®¹è‡ªåŠ¨åˆ†é…ç»™æœ€åˆé€‚çš„å®¢æœ
    
  - name: CaseSLACalculation
    event: beforeInsert, beforeUpdate
    description: æ ¹æ® SLA çº§åˆ«è®¡ç®—å“åº”å’Œè§£å†³æˆªæ­¢æ—¶é—´
    
  - name: CaseEscalationCheck
    event: afterUpdate
    description: æ£€æŸ¥ SLA è¿è§„å¹¶è‡ªåŠ¨å‡çº§
    
  - name: CaseAIAnalysis
    event: afterInsert, afterUpdate
    description: AI åˆ†æå·¥å•å†…å®¹ï¼Œè‡ªåŠ¨åˆ†ç±»å¹¶æ¨èè§£å†³æ–¹æ¡ˆ
