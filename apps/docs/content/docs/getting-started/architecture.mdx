---
title: Architecture
description: Understanding HotCRM's architecture and design principles
---

## Overview

HotCRM is built on the **ObjectStack Protocol** and follows a **Plugin-Based Monorepo** architecture. This design provides enterprise-grade stability while maintaining startup-level development velocity.

## Core Architecture Principles

### 1. Metadata-Driven Everything

All business logic is defined as **metadata**, not code:

```typescript
// Business objects are metadata
export const Account: ObjectSchema = {
  name: 'account',
  fields: [
    Field.text({ name: 'name', required: true }),
    Field.currency({ name: 'annual_revenue' }),
  ],
};

// UI layouts are metadata
export const AccountPage: PageSchema = {
  object: 'account',
  layout: 'standard',
  sections: [...],
};

// Workflows are metadata
export const LeadConversion: WorkflowSchema = {
  trigger: 'before_update',
  conditions: [...],
};
```

**Benefits:**
- ðŸ”’ Type-safe and validated
- ðŸ“¦ Version-controlled
- ðŸ”„ Hot-reloadable
- ðŸ¤– AI-interpretable

### 2. The ObjectStack Engine

HotCRM runs on **@objectstack/runtime**, which provides:

#### ObjectQL Engine
Type-safe, permission-aware data access layer:

```typescript
const opportunities = await broker.find('opportunity', {
  filters: [
    ['amount', '>', 50000],
    ['stage', 'in', ['negotiation', 'proposal']],
  ],
  orderBy: [['close_date', 'asc']],
  include: ['account', 'owner'],
});
```

#### Metadata Registry
Hot-reloading schema definitions:
- Objects, Fields, Relationships
- Pages, Views, Actions
- Permissions, Validations

#### Vector Store Integration
Native RAG (Retrieval-Augmented Generation):
- Semantic search across all objects
- AI-powered recommendations
- Document embeddings

## System Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Business Packages Layer                â”‚
â”‚  (CRM, Finance, HR, Marketing, Products, etc.)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          AI Service Layer (@hotcrm/ai)          â”‚
â”‚  (Model Registry, Predictions, Caching)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      ObjectStack Runtime Engine                 â”‚
â”‚  (ObjectQL, Metadata Registry, Vector Store)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Data & Infrastructure Layer            â”‚
â”‚  (SQLite/PostgreSQL, Redis, S3, etc.)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 1: Data & Infrastructure

- **Database**: SQLite (dev), PostgreSQL (production)
- **Cache**: Redis with in-memory fallback
- **Storage**: Local filesystem or S3
- **Search**: Built-in full-text search + vector search

### Layer 2: ObjectStack Runtime

The core engine that powers everything:

**Key Components:**
- `Broker` - Main API for data operations
- `ObjectRegistry` - Schema management
- `PermissionEngine` - Field-level security
- `VectorStore` - Semantic search
- `EventBus` - Hook/trigger system

### Layer 3: AI Service Layer

The `@hotcrm/ai` package provides:

- **Model Registry**: Centralized ML model configuration
- **Prediction Service**: Multi-provider ML inference (OpenAI, AWS SageMaker, Azure ML)
- **Smart Caching**: Redis-backed prediction cache (5-min TTL)
- **A/B Testing**: Gradual model rollout with traffic splitting
- **Monitoring**: Real-time performance tracking

### Layer 4: Business Packages

Each package is a **self-contained business capability**:

| Package | Objects | AI Actions | Hooks |
|---------|---------|------------|-------|
| **crm** | 13 | 8 | 7 |
| **finance** | 4 | 3 | 1 |
| **hr** | 16 | 3 | 4 |
| **marketing** | 2 | 3 | 8 |
| **products** | 9 | 3 | 3 |
| **support** | 21 | 3 | 6 |

## File Naming Convention

HotCRM enforces **strict file suffixes** to separate concerns:

```
packages/{package}/src/
â”œâ”€â”€ *.object.ts      # Data Models (Schema)
â”œâ”€â”€ *.hook.ts        # Business Logic (Triggers)
â”œâ”€â”€ *.action.ts      # API Endpoints & AI Tools
â”œâ”€â”€ *.page.ts        # UI Page Layouts
â”œâ”€â”€ *.view.ts        # List View Configurations
â””â”€â”€ plugin.ts        # Package Entry Point
```

### Example Package Structure

```
packages/crm/src/
â”œâ”€â”€ account.object.ts           # Account schema
â”œâ”€â”€ account_ai.action.ts        # AI actions for accounts
â”œâ”€â”€ account_enrichment.hook.ts  # Auto-enrichment trigger
â”œâ”€â”€ opportunity.object.ts       # Opportunity schema
â”œâ”€â”€ opportunity.hook.ts         # Stage validation logic
â”œâ”€â”€ lead_conversion.action.ts   # Lead conversion API
â””â”€â”€ plugin.ts                   # CRM plugin initialization
```

## Data Flow

### 1. Create/Update Flow

```
User Request
  â†“
REST API (Hono)
  â†“
Broker.create/update
  â†“
Permission Check
  â†“
Validation (Schema + Custom)
  â†“
BEFORE Hooks (*.hook.ts)
  â†“
Database Write (ObjectQL â†’ SQL)
  â†“
AFTER Hooks (*.hook.ts)
  â†“
Event Broadcast
  â†“
Response
```

### 2. Query Flow

```
User Request
  â†“
REST API
  â†“
Broker.find
  â†“
Permission Check (Field-level)
  â†“
ObjectQL Query Builder
  â†“
SQL Generation
  â†“
Database Read
  â†“
Data Transform
  â†“
Response
```

### 3. AI Action Flow

```
AI Agent Request
  â†“
Action Router
  â†“
Parameter Validation
  â†“
Action.execute()
  â†“
Broker Operations
  â†“
AI Service (if needed)
  â†“
Response
```

## Plugin System

Each package is a **plugin** that implements the `Plugin` interface:

```typescript
export const CRMPlugin: Plugin = {
  name: '@hotcrm/crm',
  
  async init(context: PluginContext) {
    // Register objects
    context.objectRegistry.register(Account);
    context.objectRegistry.register(Contact);
    
    // Register hooks
    context.hooks.register('account', 'before_create', enrichAccount);
    
    // Register actions
    context.actions.register(AccountAIAction);
  },
};
```

## Extensibility

### Custom Packages

Create your own packages following the same pattern:

```bash
packages/
â””â”€â”€ my-custom-package/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ custom_object.object.ts
    â”‚   â”œâ”€â”€ custom_logic.hook.ts
    â”‚   â”œâ”€â”€ custom_api.action.ts
    â”‚   â””â”€â”€ plugin.ts
    â”œâ”€â”€ package.json
    â””â”€â”€ tsconfig.json
```

### Custom Fields

Add custom fields to existing objects:

```typescript
// Extend the Account object
context.objectRegistry.addFields('account', [
  Field.text({ name: 'industry_custom', label: 'Custom Industry' }),
]);
```

### Custom Hooks

Add business logic to any object:

```typescript
context.hooks.register('opportunity', 'before_update', async (data, context) => {
  if (data.stage === 'closed_won') {
    // Custom logic when opportunity is won
  }
});
```

## Performance Characteristics

### ObjectQL Performance

- **Simple queries**: < 10ms
- **Complex joins**: < 50ms
- **Aggregations**: < 100ms

### Caching Strategy

- **Metadata**: Cached in memory, hot-reloaded on change
- **Query results**: Redis cache with configurable TTL
- **AI predictions**: 5-minute cache with smart invalidation

### Scalability

- **Horizontal scaling**: Run multiple server instances
- **Database**: Supports PostgreSQL for production
- **Read replicas**: ObjectQL supports read/write splitting
- **Vector search**: Scalable with dedicated vector DB (Pinecone, Weaviate)

## Security Architecture

### Permission Model

Field-level permissions based on:
- User roles
- Object types
- Record ownership
- Custom permission sets

### Data Isolation

- Multi-tenant support (coming soon)
- Row-level security (RLS)
- Field-level encryption for sensitive data

## Next Steps

<Cards>
  <Card title="Quick Start Guide" href="/docs/getting-started/quick-start" />
  <Card title="Features Overview" href="/docs/features/overview" />
  <Card title="API Reference" href="/docs/packages/overview" />
</Cards>
