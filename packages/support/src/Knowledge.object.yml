# Knowledge Object Definition
# çŸ¥è¯†åº“ç®¡ç† - Service & Customer Success Domain
# Follows @objectstack/spec standard for enterprise CRM

name: Knowledge
label: çŸ¥è¯†åº“
labelPlural: çŸ¥è¯†åº“
icon: book
description: å¸®åŠ©æ–‡æ¡£ã€FAQ å’Œè§£å†³æ–¹æ¡ˆåº“ï¼Œæ”¯æŒ AI é—®ç­”

# Enable core features
features:
  searchable: true
  trackFieldHistory: true
  enableNotes: false
  enableAttachments: true
  enableVersioning: true

# Field Definitions
fields:
  # Basic Information
  - name: Title
    type: text
    label: æ ‡é¢˜
    required: true
    searchable: true
    length: 255
    
  - name: KnowledgeNumber
    type: autoNumber
    label: çŸ¥è¯†ç¼–å·
    format: KB-{YYYY}-{0000}
    readonly: true
    searchable: true
    
  - name: UrlName
    type: text
    label: URL åç§°
    unique: true
    length: 255
    description: ç”¨äºç”Ÿæˆå‹å¥½çš„ URLï¼Œå¦‚ kb/how-to-reset-password
    
  # Content
  - name: Summary
    type: textarea
    label: æ‘˜è¦
    required: true
    length: 1000
    searchable: true
    description: æ–‡ç« ç®€çŸ­æ‘˜è¦ï¼Œç”¨äºæœç´¢ç»“æœå±•ç¤º
    
  - name: Content
    type: textarea
    label: å†…å®¹
    required: true
    length: 65000
    searchable: true
    description: å¯Œæ–‡æœ¬å†…å®¹ï¼Œæ”¯æŒ Markdown æˆ– HTML
    
  # Classification
  - name: Category
    type: select
    label: åˆ†ç±»
    required: true
    options:
      - label: ğŸ“˜ äº§å“æŒ‡å—
        value: Product Guide
      - label: â“ FAQ
        value: FAQ
      - label: ğŸ”§ æ•…éšœæ’æŸ¥
        value: Troubleshooting
      - label: ğŸ“ æ•™ç¨‹
        value: Tutorial
      - label: ğŸ“‹ æœ€ä½³å®è·µ
        value: Best Practices
      - label: ğŸ†• æ–°åŠŸèƒ½
        value: New Features
      - label: ğŸ“– API æ–‡æ¡£
        value: API Documentation
      - label: ğŸ¯ å…¶ä»–
        value: Other
        
  - name: SubCategory
    type: text
    label: å­åˆ†ç±»
    length: 100
    
  - name: Tags
    type: text
    label: æ ‡ç­¾
    length: 500
    searchable: true
    description: é€—å·åˆ†éš”çš„æ ‡ç­¾ï¼Œå¦‚ï¼šç™»å½•,å¯†ç ,å®‰å…¨
    
  # Product Association
  - name: ProductId
    type: lookup
    label: ç›¸å…³äº§å“
    referenceTo: Product
    
  - name: ApplicableProducts
    type: text
    label: é€‚ç”¨äº§å“
    length: 500
    description: å¤šä¸ªäº§å“ IDï¼Œé€—å·åˆ†éš”
    
  # Publishing
  - name: Status
    type: select
    label: çŠ¶æ€
    required: true
    defaultValue: Draft
    options:
      - label: ğŸ“ è‰ç¨¿
        value: Draft
      - label: ğŸ” å®¡æ ¸ä¸­
        value: In Review
      - label: âœ… å·²å‘å¸ƒ
        value: Published
      - label: ğŸ“¦ å·²å½’æ¡£
        value: Archived
        
  - name: PublishedDate
    type: datetime
    label: å‘å¸ƒæ—¥æœŸ
    readonly: true
    
  - name: ArchivedDate
    type: datetime
    label: å½’æ¡£æ—¥æœŸ
    readonly: true
    
  - name: LastReviewedDate
    type: date
    label: æœ€åå®¡æ ¸æ—¥æœŸ
    
  - name: NextReviewDate
    type: date
    label: ä¸‹æ¬¡å®¡æ ¸æ—¥æœŸ
    description: å»ºè®®å®šæœŸå®¡æ ¸çŸ¥è¯†åº“å†…å®¹
    
  # Visibility
  - name: Visibility
    type: select
    label: å¯è§æ€§
    required: true
    defaultValue: Internal
    options:
      - label: ğŸŒ å…¬å¼€
        value: Public
      - label: ğŸ”’ å†…éƒ¨
        value: Internal
      - label: ğŸ« å®¢æˆ·é—¨æˆ·
        value: Customer Portal
      - label: ğŸ¤ åˆä½œä¼™ä¼´
        value: Partner
        
  - name: RequireLogin
    type: checkbox
    label: éœ€è¦ç™»å½•
    defaultValue: false
    
  # Statistics
  - name: ViewCount
    type: number
    label: æµè§ˆæ¬¡æ•°
    precision: 0
    readonly: true
    defaultValue: 0
    
  - name: HelpfulCount
    type: number
    label: æœ‰å¸®åŠ©æ¬¡æ•°
    precision: 0
    readonly: true
    defaultValue: 0
    
  - name: NotHelpfulCount
    type: number
    label: æ— å¸®åŠ©æ¬¡æ•°
    precision: 0
    readonly: true
    defaultValue: 0
    
  - name: HelpfulScore
    type: percent
    label: æœ‰ç”¨ç‡
    readonly: true
    description: æœ‰å¸®åŠ©æ¬¡æ•° / (æœ‰å¸®åŠ© + æ— å¸®åŠ©)
    
  - name: AverageRating
    type: number
    label: å¹³å‡è¯„åˆ†
    precision: 1
    readonly: true
    min: 1
    max: 5
    
  # Related Cases
  - name: CasesResolvedCount
    type: number
    label: è§£å†³å·¥å•æ•°
    precision: 0
    readonly: true
    defaultValue: 0
    description: ä½¿ç”¨æœ¬æ–‡è§£å†³çš„å·¥å•æ•°é‡
    
  # Author
  - name: AuthorId
    type: lookup
    label: ä½œè€…
    referenceTo: User
    required: true
    
  - name: ReviewerId
    type: lookup
    label: å®¡æ ¸äºº
    referenceTo: User
    
  # SEO
  - name: MetaDescription
    type: textarea
    label: Meta æè¿°
    length: 200
    description: ç”¨äºæœç´¢å¼•æ“ä¼˜åŒ–
    
  - name: Keywords
    type: text
    label: å…³é”®è¯
    length: 500
    searchable: true
    
  # Version Control
  - name: VersionNumber
    type: number
    label: ç‰ˆæœ¬å·
    precision: 1
    readonly: true
    defaultValue: 1.0
    
  - name: VersionNotes
    type: textarea
    label: ç‰ˆæœ¬è¯´æ˜
    length: 2000
    
  # AI Enhancement Fields
  - name: AIGeneratedSummary
    type: textarea
    label: AI ç”Ÿæˆæ‘˜è¦
    readonly: true
    length: 1000
    description: AI è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ç« æ‘˜è¦
    
  - name: AIRelatedArticles
    type: text
    label: AI æ¨èç›¸å…³æ–‡ç« 
    readonly: true
    length: 500
    description: çŸ¥è¯†åº“æ–‡ç«  ID åˆ—è¡¨
    
  - name: AIEmbedding
    type: text
    label: AI å‘é‡åµŒå…¥
    readonly: true
    length: 5000
    description: ç”¨äº RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) çš„å‘é‡è¡¨ç¤º
    
  - name: AIQAScore
    type: number
    label: AI é—®ç­”è´¨é‡åˆ†æ•°
    precision: 2
    readonly: true
    min: 0
    max: 100
    description: æ–‡ç« ç”¨äº AI é—®ç­”çš„è´¨é‡è¯„åˆ†

# Relationships
relationships:
  - name: KnowledgeFeedback
    type: hasMany
    object: KnowledgeFeedback
    foreignKey: KnowledgeId
    label: ç”¨æˆ·åé¦ˆ
    
  - name: Cases
    type: hasMany
    object: Case
    foreignKey: KnowledgeId
    label: å…³è”å·¥å•

# List Views
listViews:
  - name: AllArticles
    label: æ‰€æœ‰æ–‡ç« 
    filters: []
    columns:
      - KnowledgeNumber
      - Title
      - Category
      - Status
      - ViewCount
      - HelpfulScore
      - PublishedDate
    sortBy: PublishedDate
    sortOrder: desc
    
  - name: Published
    label: å·²å‘å¸ƒ
    filters:
      - field: Status
        operator: equals
        value: Published
    columns:
      - Title
      - Category
      - SubCategory
      - ViewCount
      - HelpfulScore
      - PublishedDate
    sortBy: ViewCount
    sortOrder: desc
    
  - name: MyArticles
    label: æˆ‘çš„æ–‡ç« 
    filters:
      - field: AuthorId
        operator: equals
        value: $CurrentUser.Id
    columns:
      - Title
      - Category
      - Status
      - LastModifiedDate
      - PublishedDate
    sortBy: LastModifiedDate
    sortOrder: desc
    
  - name: NeedReview
    label: å¾…å®¡æ ¸
    filters:
      - field: Status
        operator: equals
        value: In Review
    columns:
      - Title
      - Category
      - Author
      - CreatedDate
    sortBy: CreatedDate
    sortOrder: asc
    
  - name: MostHelpful
    label: æœ€æœ‰å¸®åŠ©
    filters:
      - field: Status
        operator: equals
        value: Published
      - field: HelpfulCount
        operator: greaterThan
        value: 10
    columns:
      - Title
      - Category
      - HelpfulCount
      - HelpfulScore
      - ViewCount
    sortBy: HelpfulScore
    sortOrder: desc
    
  - name: PopularArticles
    label: çƒ­é—¨æ–‡ç« 
    filters:
      - field: Status
        operator: equals
        value: Published
    columns:
      - Title
      - Category
      - ViewCount
      - HelpfulScore
      - PublishedDate
    sortBy: ViewCount
    sortOrder: desc
    
  - name: FAQ
    label: å¸¸è§é—®é¢˜
    filters:
      - field: Category
        operator: equals
        value: FAQ
      - field: Status
        operator: equals
        value: Published
    columns:
      - Title
      - SubCategory
      - ViewCount
      - HelpfulScore
    sortBy: ViewCount
    sortOrder: desc

# Page Layout
pageLayout:
  sections:
    - label: æ–‡ç« ä¿¡æ¯
      columns: 2
      fields:
        - KnowledgeNumber
        - Title
        - UrlName
        - Status
        - Category
        - SubCategory
        - Tags
        
    - label: äº§å“å…³è”
      columns: 2
      fields:
        - ProductId
        - ApplicableProducts
        
    - label: å‘å¸ƒè®¾ç½®
      columns: 2
      fields:
        - Visibility
        - RequireLogin
        - PublishedDate
        - ArchivedDate
        
    - label: å®¡æ ¸
      columns: 2
      fields:
        - AuthorId
        - ReviewerId
        - LastReviewedDate
        - NextReviewDate
        
    - label: ç»Ÿè®¡æ•°æ®
      columns: 2
      fields:
        - ViewCount
        - HelpfulCount
        - NotHelpfulCount
        - HelpfulScore
        - AverageRating
        - CasesResolvedCount
        
    - label: ç‰ˆæœ¬æ§åˆ¶
      columns: 2
      fields:
        - VersionNumber
        - VersionNotes
        
    - label: SEO
      columns: 2
      fields:
        - MetaDescription
        - Keywords
        
    - label: AI å¢å¼º
      columns: 1
      fields:
        - AIGeneratedSummary
        - AIRelatedArticles
        - AIQAScore
        
    - label: æ‘˜è¦
      columns: 1
      fields:
        - Summary
        
    - label: å†…å®¹
      columns: 1
      fields:
        - Content

# Validation Rules
validationRules:
  - name: PublishedArticleRequiresReviewer
    errorMessage: å‘å¸ƒæ–‡ç« å¿…é¡»ç»è¿‡å®¡æ ¸äººå®¡æ ¸
    formula: |
      AND(
        Status = "Published",
        ISBLANK(ReviewerId)
      )
      
  - name: NextReviewDateInFuture
    errorMessage: ä¸‹æ¬¡å®¡æ ¸æ—¥æœŸå¿…é¡»æ˜¯æœªæ¥çš„æ—¥æœŸ
    formula: |
      AND(
        NOT(ISBLANK(NextReviewDate)),
        NextReviewDate < $TODAY
      )
      
  - name: UrlNameFormat
    errorMessage: URL åç§°åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦
    formula: |
      NOT(REGEX(UrlName, "^[a-z0-9-]+$"))

# Triggers
triggers:
  - name: KnowledgePublishing
    event: afterUpdate
    description: æ–‡ç« å‘å¸ƒæ—¶è®°å½•æ—¶é—´å¹¶ç”Ÿæˆ URL
    
  - name: KnowledgeAIProcessing
    event: afterInsert, afterUpdate
    description: AI ç”Ÿæˆæ‘˜è¦ã€æå–å…³é”®è¯å’Œåˆ›å»ºå‘é‡åµŒå…¥
    
  - name: KnowledgeHelpfulScore
    event: afterUpdate
    description: æ ¹æ®åé¦ˆè®¡ç®—æœ‰ç”¨ç‡å’Œè¯„åˆ†
    
  - name: KnowledgeVersionControl
    event: beforeUpdate
    description: é‡å¤§ä¿®æ”¹æ—¶è‡ªåŠ¨å¢åŠ ç‰ˆæœ¬å·
