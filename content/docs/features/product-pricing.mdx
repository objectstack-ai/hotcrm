---
title: Product & Pricing (CPQ)
description: Product catalog, pricebook management, and quote generation features
---

# Product & Pricing Domain

The Product & Pricing domain enables Configure-Price-Quote (CPQ) capabilities with multi-currency support, regional pricing, and AI-powered product recommendations.

## Overview

**Key Objects**: `Product`, `Pricebook`, `Quote`, `QuoteLineItem`, `ProductBundle`, `PriceRule`, `DiscountSchedule`, `ApprovalRequest`

**Main Goals**:
- Comprehensive product catalog management
- Multi-currency, multi-region pricing strategies
- Complex quote configuration
- Discount approval workflows
- AI-driven product bundling and pricing optimization

## Product Catalog Management

### Product Object

The Product object represents goods and services you sell.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| Name | Text | Product name (required) |
| ProductCode | Text | SKU or product code (unique) |
| Description | Textarea | Product description |
| Family | Picklist | Product family/category |
| IsActive | Checkbox | Is product available for sale? |
| ProductType | Picklist | Physical, Digital, Service, Subscription |
| ListPrice | Currency | Standard/suggested retail price |
| CostPrice | Currency | Cost of goods sold |
| QuantityUnitOfMeasure | Picklist | Unit, Set, Device, License, Hour, etc. |
| QuantityInStock | Number | Current stock quantity |
| ReorderLevel | Number | Reorder threshold |
| StockStatus | Picklist | In Stock, Low Stock, Out of Stock, Reordering |
| Weight | Number | Weight in kg |
| Dimensions | Text | Dimensions (LÃ—WÃ—H in cm) |
| VendorName | Text | Supplier name |
| ProductUrl | URL | Product page URL |
| ImageUrl | URL | Product image URL |
| MinimumOrderQuantity | Number | Minimum order quantity |
| MaximumOrderQuantity | Number | Maximum order quantity |

#### Product Families

- **Software**: Software products and licenses
- **Hardware**: Physical hardware devices
- **Professional Services**: Consulting and implementation
- **Consulting**: Advisory services
- **Training**: Training courses and workshops
- **Support**: Support and maintenance plans
- **Subscription**: Recurring subscription services
- **Other**: Other product types

#### Product Types

- **Physical**: Tangible products requiring inventory
- **Digital**: Software downloads, digital content
- **Service**: Professional services (hourly/daily)
- **Subscription**: Recurring revenue products

### Inventory Management

Track stock levels and automate reordering:

```typescript
// Check low stock products
const lowStock = await db.find('Product', {
  filters: [
    ['StockStatus', 'in', ['Low Stock', 'Out of Stock']],
    ['IsActive', '=', true]
  ],
  orderBy: { field: 'QuantityInStock', direction: 'asc' }
});

// Auto-update stock status (via trigger)
if (product.QuantityInStock === 0) {
  stockStatus = 'Out of Stock';
} else if (product.QuantityInStock < product.ReorderLevel) {
  stockStatus = 'Low Stock';
} else {
  stockStatus = 'In Stock';
}
```

### Units of Measure

Support various measurement units:

- **Unit**: Individual items (pieces)
- **Set**: Bundled sets
- **Device**: Devices/equipment
- **License**: Software licenses
- **User**: Per-user licensing
- **Hour**: Hourly services
- **Day**: Daily services
- **Month**: Monthly subscriptions
- **Year**: Annual subscriptions

### AI Features

#### Sales Points Generation (AISalesPoints)

AI automatically generates compelling sales messaging:

```typescript
"Key Selling Points for 'Enterprise CRM Platform':

âœ¨ Unique Value Propositions:
- 40% lower TCO compared to Salesforce
- Native China deployment (no VPN required)
- Advanced AI capabilities built-in
- Industry-leading customization

ðŸŽ¯ Target Audience:
- Enterprise companies with 500+ users
- Organizations expanding in Asia-Pacific
- Companies requiring extensive customization

ðŸ’¼ Use Cases:
- Global sales team coordination
- Multi-currency deal management
- Complex approval workflows
- Customer 360-degree view"
```

#### Product Bundling Recommendations (AIRecommendedProducts)

Smart product combinations:

```typescript
"Recommended Bundle for 'CRM Enterprise License':
1. Training Package (Professional Services) - 80% attach rate
2. Premium Support (12 months) - 95% attach rate
3. API Integration Service - 60% attach rate
4. Mobile App Add-on - 50% attach rate

Total bundle value: $45,000 (vs. $52,000 individual)
Average discount: 13%
Win rate when bundled: 78% (vs. 52% standalone)"
```

#### Pricing Strategy (AIPricingStrategy)

AI-powered pricing recommendations:

```typescript
"Pricing Strategy Analysis:

Current Price: $299/user/month
Market Position: Premium (85th percentile)

Recommendations:
1. Consider volume discounts:
   - 100-500 users: 15% discount
   - 500-1000 users: 25% discount
   - 1000+ users: 35% discount

2. Competitive positioning:
   - 40% lower than Salesforce
   - 20% higher than HubSpot
   - Differentiate on China deployment

3. Upsell opportunities:
   - API access: +$50/user/month
   - Advanced analytics: +$30/user/month
   - Premium support: +$25/user/month"
```

### List Views

1. **All Products**: All products in catalog
2. **Active Products**: IsActive = true
3. **Software Products**: Family = Software
4. **Services**: Family in [Professional Services, Consulting, Training, Support]
5. **Low Stock**: StockStatus in [Low Stock, Out of Stock]

## Price Management

### Pricebook Object

The Pricebook object manages pricing for different currencies, regions, and sales channels.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| Name | Text | Pricebook name (required) |
| Description | Textarea | Pricebook description |
| IsActive | Checkbox | Is pricebook available for use? |
| IsStandard | Checkbox | Is this the standard pricebook? |
| PricingStrategy | Picklist | Pricing strategy type |
| Currency | Picklist | CNY, USD, EUR, GBP, JPY, HKD, SGD |
| Region | Picklist | Geographic region |
| SalesChannel | Picklist | Sales channel type |
| StartDate | Date | Effective start date |
| EndDate | Date | Expiration date |
| IsValid | Checkbox | Currently valid (calculated) |
| TotalProducts | Number | Number of products (calculated) |
| AverageDiscount | Percent | Average discount vs. standard |

#### Pricing Strategies

- **Standard**: Default pricing
- **Discount**: Discounted pricing
- **Channel**: Partner/reseller pricing
- **Regional**: Geographic-specific pricing
- **VIP**: Premium customer pricing
- **Promotion**: Promotional pricing
- **Volume**: Quantity-based pricing

#### Multi-Currency Support

HotCRM supports 7 major currencies:

- **CNY**: Chinese Yuan (äººæ°‘å¸)
- **USD**: US Dollar (ç¾Žå…ƒ)
- **EUR**: Euro (æ¬§å…ƒ)
- **GBP**: British Pound (è‹±é•‘)
- **JPY**: Japanese Yen (æ—¥å…ƒ)
- **HKD**: Hong Kong Dollar (æ¸¯å¸)
- **SGD**: Singapore Dollar (æ–°åŠ å¡å…ƒ)

#### Regional Pricing

Define different prices by geography:

- **Global**: Worldwide default
- **China Mainland**: ä¸­å›½å¤§é™†
- **HK/Macau/Taiwan**: æ¸¯æ¾³å°
- **North America**: åŒ—ç¾Ž
- **Europe**: æ¬§æ´²
- **Asia Pacific**: äºšå¤ª
- **Middle East**: ä¸­ä¸œ
- **Other**: å…¶ä»–åœ°åŒº

#### Sales Channels

Price differently by distribution channel:

- **Direct**: Direct sales team
- **Channel**: Channel partners/resellers
- **Online**: E-commerce website
- **Retail**: Retail stores
- **Distribution**: Distributors
- **Agent**: Sales agents

### Standard Pricebook

Every HotCRM instance has one standard pricebook:

```typescript
// System enforces only one standard pricebook
{
  Name: 'Standard Pricebook',
  IsStandard: true,
  Currency: 'CNY', // Must be CNY
  IsActive: true
}
```

**Validation**: Standard pricebook must use CNY currency.

### Creating Regional Pricebooks

```typescript
// Create US pricebook
const usPricebook = await db.doc.create('Pricebook', {
  Name: 'US Direct Sales - 2026',
  Currency: 'USD',
  Region: 'North America',
  SalesChannel: 'Direct',
  PricingStrategy: 'Standard',
  StartDate: '2026-01-01',
  EndDate: '2026-12-31',
  IsActive: true
});

// Create China channel pricebook with 20% discount
const chinaPricebook = await db.doc.create('Pricebook', {
  Name: 'China Channel Partner - 2026',
  Currency: 'CNY',
  Region: 'China Mainland',
  SalesChannel: 'Channel',
  PricingStrategy: 'Discount',
  StartDate: '2026-01-01',
  EndDate: '2026-12-31',
  IsActive: true
});
```

### Pricebook Entries

Products must be added to pricebooks with specific prices:

```typescript
// Add product to US pricebook
await db.doc.create('PricebookEntry', {
  PricebookId: usPricebook.Id,
  ProductId: crmProductId,
  UnitPrice: 299.00, // $299 USD
  IsActive: true
});

// Add same product to China pricebook
await db.doc.create('PricebookEntry', {
  PricebookId: chinaPricebook.Id,
  ProductId: crmProductId,
  UnitPrice: 1999.00, // Â¥1999 CNY
  IsActive: true
});
```

### List Views

1. **All Pricebooks**: All pricebooks in system
2. **Active Pricebooks**: IsActive = true
3. **Valid Pricebooks**: IsValid = true and IsActive = true
4. **By Currency**: Group by currency
5. **Expiring Pricebooks**: EndDate within next 30 days

## Quotation (CPQ)

### Quote Object

The Quote object enables Configure-Price-Quote with complex discount approvals.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| QuoteNumber | AutoNumber | Auto-generated quote number |
| Name | Text | Quote name (required) |
| Status | Picklist | Quote status |
| OpportunityId | Reference | Related opportunity (required) |
| AccountId | Reference | Customer account (required) |
| ContactId | Reference | Primary contact |
| PricebookId | Reference | Pricebook to use (required) |
| QuoteDate | Date | Quote date (default: today) |
| ExpirationDate | Date | Quote expiration date |
| ValidityPeriodDays | Number | Valid for (days) |
| Subtotal | Currency | Sum of line items (calculated) |
| DiscountPercent | Percent | Overall discount percentage |
| DiscountAmount | Currency | Discount in currency (calculated) |
| TaxPercent | Percent | Tax rate |
| TaxAmount | Currency | Tax amount (calculated) |
| ShippingHandling | Currency | Shipping cost |
| TotalPrice | Currency | Grand total (calculated) |
| PaymentTerms | Picklist | Payment terms |
| DeliveryTerms | Picklist | Delivery terms |
| ApprovalStatus | Picklist | Approval workflow status |
| ApprovalLevel | Number | Required approval level |
| Description | Textarea | Quote description |
| InternalNotes | Textarea | Internal notes (not shown to customer) |

#### Quote Status Flow

1. **ðŸ“ Draft** - Being prepared
2. **ðŸ”„ In Review** - Under review
3. **âœ… Approved** - Approved for sending
4. **âŒ Rejected** - Rejected
5. **ðŸ“§ Sent** - Sent to customer
6. **ðŸ¤ Customer Accepted** - Customer accepted
7. **ðŸš« Expired** - Past expiration date

### Quote Calculation

Prices are automatically calculated:

```typescript
// Automatic calculation formula
Subtotal = Sum of all QuoteLineItems (Quantity Ã— UnitPrice)
DiscountAmount = Subtotal Ã— DiscountPercent
TaxAmount = (Subtotal - DiscountAmount) Ã— TaxPercent
TotalPrice = Subtotal - DiscountAmount + TaxAmount + ShippingHandling
```

**Example**:
```
Subtotal:          $100,000.00
Discount (15%):    -$15,000.00
Subtotal after:     $85,000.00
Tax (13%):         +$11,050.00
Shipping:           +$1,000.00
----------------------------
Total Price:        $97,050.00
```

### Payment Terms

- **Full Prepayment**: 100% upfront
- **30/70 Split**: 30% down, 70% on acceptance
- **50/50 Split**: 50% down, 50% on acceptance
- **Net 30**: Payment due 30 days after acceptance
- **Net 60**: Payment due 60 days after acceptance
- **Net 90**: Payment due 90 days after acceptance
- **Installments**: Custom payment schedule
- **Other**: Custom terms

### Delivery Terms

- **On-site Delivery**: Delivered to customer location
- **Remote Delivery**: Remote installation/configuration
- **Cloud Deployment**: Hosted in cloud
- **Shipping**: Physical shipment
- **Digital Download**: Software download
- **Other**: Custom delivery

### Discount Approval Workflow

Discounts trigger multi-level approvals:

| Discount % | Approval Level | Approver |
|------------|----------------|----------|
| 0-10% | 0 | Sales Rep (auto-approved) |
| 10-20% | 1 | Sales Manager |
| 20-30% | 2 | Director of Sales |
| 30%+ | 3 | VP of Sales or CFO |

```typescript
// Trigger approval workflow
if (quote.DiscountPercent > 0.20) {
  await db.doc.update('Quote', quote.Id, {
    Status: 'In Review',
    ApprovalStatus: 'Pending',
    ApprovalLevel: 2 // Director approval needed
  });
  
  // Route to director
  await createApprovalRequest({
    objectType: 'Quote',
    objectId: quote.Id,
    approverId: directorOfSalesId,
    reason: `Discount of ${quote.DiscountPercent * 100}% requires director approval`
  });
}
```

### PDF Generation

Quotes can be exported as professional PDFs:

```typescript
// Generate quote PDF
await generateQuotePDF(quote.Id);

// Updates quote record
{
  PDFGeneratedDate: new Date(),
  PDFUrl: 'https://storage.hotcrm.com/quotes/Q-2026-01-0042.pdf'
}
```

### AI Features

#### Product Bundle Recommendations (AIRecommendedBundle)

AI suggests optimal product combinations:

```typescript
"Recommended Bundle based on $150K budget:

Option 1: Balanced Solution ($148K)
- CRM Enterprise (500 users): $120K
- Professional Services (80 hrs): $16K
- Premium Support (12 months): $12K
Win Probability: 72%

Option 2: Premium Solution ($195K - suggest upsell)
- CRM Enterprise (500 users): $120K
- Advanced Analytics Add-on: $30K
- Professional Services (120 hrs): $24K
- Premium Support (12 months): $12K
- Mobile App Licenses: $9K
Win Probability: 65%

Recommendation: Start with Option 1, upsell Analytics in 6 months."
```

#### Optimal Discount (AIOptimalDiscount)

Data-driven discount recommendations:

```typescript
"Optimal Discount Analysis:

Current Discount: 15%
AI Recommended: 12%

Reasoning:
- Historical win rate at 12%: 68%
- Historical win rate at 15%: 70% (marginal gain)
- Revenue impact: +$4,500 with 12% discount
- Customer's budget confirmed, price not main concern
- Competitor pricing allows lower discount

Recommendation: Start at 10%, max 12%"
```

#### Win Probability Prediction (AIWinProbability)

Predict quote success:

```typescript
{
  winProbability: 67,
  confidence: 'High',
  factors: {
    positive: [
      'Strong relationship with decision maker',
      'Budget confirmed and allocated',
      'Timeline matches their needs',
      'No active competitors identified'
    ],
    negative: [
      'Price 20% above initial budget',
      'Long approval process (45 days)',
      'Economic buyer not fully engaged'
    ],
    recommendations: [
      'Reduce discount to 10% (still competitive)',
      'Schedule call with economic buyer',
      'Add value-adds instead of deeper discount'
    ]
  }
}
```

#### Pricing Competitiveness (AIPricingAnalysis)

Market positioning analysis:

```typescript
"Pricing Competitiveness Analysis:

Your Quote: $97,050
Market Range: $85,000 - $125,000
Position: Mid-range (competitive)

vs. Salesforce: 35% lower âœ…
vs. HubSpot: 15% higher âš ï¸
vs. Microsoft Dynamics: 20% lower âœ…

Value Proposition:
- Better price than enterprise competitors
- Justify premium over HubSpot with:
  * Enterprise-grade security
  * Advanced customization
  * China deployment
  * Dedicated support

Competitive Response:
If customer mentions HubSpot pricing:
1. Highlight enterprise features
2. Offer premium support bundle
3. Show TCO over 3 years (we win)"
```

### Example Workflow: Creating a Quote

```typescript
// 1. Create quote
const quote = await db.doc.create('Quote', {
  Name: 'Acme Corp - CRM Enterprise Solution',
  OpportunityId: opportunityId,
  AccountId: accountId,
  ContactId: contactId,
  PricebookId: usPricebookId,
  QuoteDate: new Date(),
  ExpirationDate: '2026-03-15', // 30 days validity
  PaymentTerms: '50/50 Split',
  DeliveryTerms: 'Cloud Deployment',
  Status: 'Draft'
});

// 2. Add line items
await db.doc.create('QuoteLineItem', {
  QuoteId: quote.Id,
  ProductId: crmEnterpriseId,
  Quantity: 500,
  UnitPrice: 299.00,
  Description: 'CRM Enterprise - 500 users, annual subscription'
});

await db.doc.create('QuoteLineItem', {
  QuoteId: quote.Id,
  ProductId: trainingId,
  Quantity: 40,
  UnitPrice: 200.00,
  Description: 'On-site training - 40 hours'
});

// 3. Apply discount
await db.doc.update('Quote', quote.Id, {
  DiscountPercent: 0.15, // 15% discount
  TaxPercent: 0.13, // 13% tax
  ShippingHandling: 1000.00
});
// Subtotal, DiscountAmount, TaxAmount, TotalPrice calculated automatically

// 4. Submit for approval (if discount > 10%)
await db.doc.update('Quote', quote.Id, {
  Status: 'In Review'
});

// 5. After approval, send to customer
await db.doc.update('Quote', quote.Id, {
  Status: 'Sent'
});
await sendQuoteEmail(quote.Id);

// 6. Customer accepts
await db.doc.update('Quote', quote.Id, {
  Status: 'Customer Accepted'
});
```

### List Views

1. **All Quotes**: All quotes in system
2. **My Quotes**: Quotes I own
3. **Draft Quotes**: Status = Draft
4. **Pending Approval**: ApprovalStatus = Pending
5. **Approved**: ApprovalStatus = Approved
6. **Expiring**: ExpirationDate within next 7 days

## Best Practices

### Product Management

1. **Keep SKUs Unique**: Ensure ProductCode is unique for inventory tracking
2. **Complete Descriptions**: Write detailed product descriptions for customer clarity
3. **Set Reorder Levels**: Configure ReorderLevel to automate inventory alerts
4. **Use Product Families**: Organize products into logical families for reporting
5. **Maintain Images**: Add ImageUrl for better visual presentation
6. **Set Min/Max Quantities**: Define ordering constraints
7. **Leverage AI**: Use AI-generated sales points in customer presentations

### Pricebook Management

1. **One Standard**: Maintain one standard pricebook as baseline
2. **Date Validity**: Set StartDate and EndDate for seasonal pricing
3. **Regional Pricing**: Create separate pricebooks for different regions
4. **Channel Pricing**: Differentiate direct vs. channel pricing
5. **Review Regularly**: Update prices at least annually
6. **Document Strategy**: Use Description field to explain pricing strategy

### Quote Management

1. **Link to Opportunity**: Always associate quotes with opportunities
2. **Set Expiration**: Define clear ExpirationDate (typically 30 days)
3. **Document Assumptions**: Use InternalNotes for special conditions
4. **Seek Approval Early**: Submit for approval before sending to customer
5. **Track Versions**: Create new quote versions instead of editing sent quotes
6. **Generate PDFs**: Always generate professional PDF before sending
7. **Use AI Recommendations**: Review AI bundle and discount suggestions
8. **Follow Up**: Monitor quote status and follow up before expiration

## Example Workflows

### End-to-End CPQ Process

```typescript
// 1. Customer requests quote for 500 users
const opportunity = await db.findOne('Opportunity', oppId);

// 2. AI recommends product bundle
const bundle = await aiRecommendProductBundle({
  accountId: opportunity.AccountId,
  budget: 150000,
  userCount: 500
});

// 3. Create quote with recommended products
const quote = await db.doc.create('Quote', {
  Name: `${opportunity.Name} - Quote`,
  OpportunityId: opportunity.Id,
  AccountId: opportunity.AccountId,
  ContactId: opportunity.ContactId,
  PricebookId: await getDefaultPricebook(opportunity.AccountId),
  QuoteDate: new Date(),
  ExpirationDate: addDays(new Date(), 30)
});

// 4. Add AI-recommended line items
for (const item of bundle.items) {
  await db.doc.create('QuoteLineItem', {
    QuoteId: quote.Id,
    ProductId: item.productId,
    Quantity: item.quantity,
    UnitPrice: item.unitPrice
  });
}

// 5. Apply AI-suggested discount
await db.doc.update('Quote', quote.Id, {
  DiscountPercent: bundle.suggestedDiscount / 100
});

// 6. Review and adjust
const pricing = await aiAnalyzePricing(quote.Id);
console.log(`Win probability: ${pricing.winProbability}%`);
console.log(`Competitive position: ${pricing.competitivePosition}`);

// 7. Submit for approval if needed
if (quote.DiscountPercent > 0.10) {
  await submitForApproval(quote.Id);
}

// 8. After approval, generate PDF and send
await generateQuotePDF(quote.Id);
await sendQuoteToCustomer(quote.Id);

// 9. Track customer response
// (Customer accepts via portal or email)

// 10. Convert to contract
if (quote.Status === 'Customer Accepted') {
  await convertQuoteToContract(quote.Id);
}
```

## Quote Line Items

### Quote Line Item Object

Individual products/services on a quote with detailed pricing.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| QuoteId | Reference | Parent quote (required) |
| ProductId | Reference | Product being quoted (required) |
| LineNumber | Number | Line number (for ordering) |
| Quantity | Number | Quantity (required) |
| ListPrice | Currency | Product list price |
| UnitPrice | Currency | Unit price (after discount) |
| Discount | Percent | Line-level discount percentage |
| DiscountAmount | Currency | Discount amount (calculated) |
| Subtotal | Currency | Quantity Ã— UnitPrice (calculated) |
| TotalPrice | Currency | Final price after discount (calculated) |
| Description | Textarea | Line item description |
| ProductCode | Text | Product SKU |
| ServiceDate | Date | Service start date |
| Recurring | Checkbox | Recurring subscription |
| RecurringPeriod | Picklist | Monthly, Quarterly, Annually |
| TaxRate | Percent | Tax rate |
| TaxAmount | Currency | Tax amount (calculated) |

**Example Usage**:
```typescript
// Add product to quote
await db.doc.create('QuoteLineItem', {
  QuoteId: quoteId,
  ProductId: productId,
  LineNumber: 1,
  Quantity: 10,
  ListPrice: 1000,
  UnitPrice: 900, // 10% discount
  Discount: 10,
  Description: 'Enterprise CRM License - Annual',
  Recurring: true,
  RecurringPeriod: 'Annually',
  TaxRate: 8.5
});

// Calculated fields (automatic)
{
  DiscountAmount: 100, // (1000 - 900) Ã— 10
  Subtotal: 9000, // 10 Ã— 900
  TaxAmount: 765, // 9000 Ã— 0.085
  TotalPrice: 9765 // 9000 + 765
}
```

## Product Bundling

### Product Bundle Object

Pre-configured product bundles for cross-selling.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| Name | Text | Bundle name (required) |
| BundleCode | Text | Unique bundle code |
| Description | Textarea | Bundle description |
| IsActive | Checkbox | Bundle is available |
| BundleType | Picklist | Static, Dynamic, Configurable |
| PricingMethod | Picklist | Fixed, Component Sum, Percentage Off |
| FixedPrice | Currency | Fixed bundle price |
| DiscountPercent | Percent | Discount off component sum |
| ValidFrom | Date | Valid from date |
| ValidTo | Date | Valid to date |
| MinimumQuantity | Number | Minimum bundle quantity |
| MaximumQuantity | Number | Maximum bundle quantity |

**Example Usage**:
```typescript
// Create "Starter Pack" bundle
const bundle = await db.doc.create('ProductBundle', {
  Name: 'CRM Starter Pack',
  BundleCode: 'BUNDLE-STARTER',
  Description: 'Everything you need to get started',
  IsActive: true,
  BundleType: 'Static',
  PricingMethod: 'Percentage Off',
  DiscountPercent: 15, // 15% off individual prices
  ValidFrom: new Date('2026-01-01'),
  ValidTo: new Date('2026-12-31')
});

// Add products to bundle
const bundleItems = [
  { ProductId: crmLicenseId, Quantity: 5, IsRequired: true },
  { ProductId: trainingId, Quantity: 1, IsRequired: true },
  { ProductId: supportId, Quantity: 1, IsRequired: false } // Optional
];

// AI recommends bundles based on customer needs
const recommendations = await getAIBundleRecommendations({
  accountId: accountId,
  budget: 50000,
  industry: 'Technology'
});
```

## Advanced Pricing

### Price Rule Object

Dynamic pricing rules based on quantity, customer, or time.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| Name | Text | Rule name (required) |
| IsActive | Checkbox | Rule is active |
| Priority | Number | Rule priority (1-100) |
| ProductId | Reference | Specific product (optional) |
| ProductFamily | Picklist | Product family (optional) |
| RuleType | Picklist | Volume, Customer Tier, Geographic, Time-Based |
| Conditions | Textarea | JSON conditions |
| DiscountType | Picklist | Percentage, Fixed Amount, Price Override |
| DiscountValue | Number | Discount value |
| ValidFrom | Date | Valid from date |
| ValidTo | Date | Valid to date |
| MinimumQuantity | Number | Minimum quantity |
| MaximumQuantity | Number | Maximum quantity |

**Example Usage**:
```typescript
// Volume discount pricing
await db.doc.create('PriceRule', {
  Name: 'Volume Discount - 10+ Units',
  IsActive: true,
  Priority: 50,
  ProductId: productId,
  RuleType: 'Volume',
  Conditions: JSON.stringify({
    quantity: { gte: 10 }
  }),
  DiscountType: 'Percentage',
  DiscountValue: 15 // 15% off for 10+ units
});

// Customer tier pricing
await db.doc.create('PriceRule', {
  Name: 'VIP Customer Discount',
  IsActive: true,
  Priority: 80,
  ProductFamily: 'Software',
  RuleType: 'Customer Tier',
  Conditions: JSON.stringify({
    'Account.CustomerTier': 'VIP'
  }),
  DiscountType: 'Percentage',
  DiscountValue: 20
});

// Geographic pricing
await db.doc.create('PriceRule', {
  Name: 'APAC Regional Pricing',
  IsActive: true,
  Priority: 60,
  RuleType: 'Geographic',
  Conditions: JSON.stringify({
    'Account.Region': ['APAC', 'Southeast Asia']
  }),
  DiscountType: 'Fixed Amount',
  DiscountValue: 500
});

// Time-based promotions
await db.doc.create('PriceRule', {
  Name: 'Q4 End of Year Sale',
  IsActive: true,
  Priority: 90,
  RuleType: 'Time-Based',
  ValidFrom: new Date('2026-10-01'),
  ValidTo: new Date('2026-12-31'),
  DiscountType: 'Percentage',
  DiscountValue: 25
});
```

### Discount Schedule Object

Tiered discount schedules for volume pricing.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| Name | Text | Schedule name (required) |
| ProductId | Reference | Product (required) |
| IsActive | Checkbox | Schedule is active |
| Tier1MinQty | Number | Tier 1 minimum quantity |
| Tier1Discount | Percent | Tier 1 discount |
| Tier2MinQty | Number | Tier 2 minimum quantity |
| Tier2Discount | Percent | Tier 2 discount |
| Tier3MinQty | Number | Tier 3 minimum quantity |
| Tier3Discount | Percent | Tier 3 discount |
| Tier4MinQty | Number | Tier 4 minimum quantity |
| Tier4Discount | Percent | Tier 4 discount |
| Tier5MinQty | Number | Tier 5 minimum quantity |
| Tier5Discount | Percent | Tier 5 discount |

**Example Usage**:
```typescript
// Create tiered volume discount
await db.doc.create('DiscountSchedule', {
  Name: 'Enterprise License Volume Discount',
  ProductId: enterpriseLicenseId,
  IsActive: true,
  Tier1MinQty: 1,
  Tier1Discount: 0, // No discount for 1-9
  Tier2MinQty: 10,
  Tier2Discount: 10, // 10% for 10-24
  Tier3MinQty: 25,
  Tier3Discount: 15, // 15% for 25-49
  Tier4MinQty: 50,
  Tier4Discount: 20, // 20% for 50-99
  Tier5MinQty: 100,
  Tier5Discount: 25 // 25% for 100+
});

// Auto-apply discount based on quantity
const quantity = 45;
const discount = getDiscountForQuantity(scheduleId, quantity);
// Returns: 15% (Tier 3)
```

## Approval Workflows

### Approval Request Object

Discount and pricing approval requests.

#### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| QuoteId | Reference | Quote being approved (required) |
| RequestedById | Reference | Person requesting approval (required) |
| RequestedDate | DateTime | When requested |
| ApprovalType | Picklist | Discount, Price Override, Special Terms |
| DiscountRequested | Percent | Discount percentage requested |
| DiscountAmount | Currency | Dollar amount of discount |
| Justification | Textarea | Business justification (required) |
| Status | Picklist | Pending, Approved, Rejected, Recalled |
| ApproverId | Reference | Assigned approver |
| ApprovedDate | DateTime | When approved/rejected |
| ApproverComments | Textarea | Approver notes |
| EscalationLevel | Number | Approval level (1-3) |
| AutoApprovalEligible | Checkbox | Qualifies for auto-approval |

**Example Usage**:
```typescript
// Request discount approval
const approval = await db.doc.create('ApprovalRequest', {
  QuoteId: quoteId,
  RequestedById: salesRepId,
  ApprovalType: 'Discount',
  DiscountRequested: 25,
  DiscountAmount: 12500,
  Justification: 'Strategic account. Competitor offering 30% off. Must match to win deal.',
  Status: 'Pending',
  ApproverId: salesManagerId,
  EscalationLevel: 1
});

// Auto-escalate if manager doesn't approve within 24 hours
// Or if discount > threshold
if (approval.DiscountRequested > 20) {
  await db.doc.update('ApprovalRequest', approval.Id, {
    ApproverId: vpSalesId,
    EscalationLevel: 2
  });
}

// Manager approves
await db.doc.update('ApprovalRequest', approval.Id, {
  Status: 'Approved',
  ApprovedDate: new Date(),
  ApproverComments: 'Approved. This is a strategic account worth the discount.'
});

// Apply discount to quote
await db.doc.update('Quote', quoteId, {
  Discount: approval.DiscountRequested,
  ApprovalStatus: 'Approved'
});
```

**Approval Thresholds**:
```typescript
// Typical approval matrix
const approvalMatrix = {
  '0-10%': { approver: 'Sales Rep', autoApprove: true },
  '10-15%': { approver: 'Sales Manager', autoApprove: false },
  '15-20%': { approver: 'Regional Director', autoApprove: false },
  '20-25%': { approver: 'VP Sales', autoApprove: false },
  '25%+': { approver: 'CFO + VP Sales', autoApprove: false }
};
```

## Complete CPQ Workflow

```typescript
// 1. Sales rep creates opportunity
const opp = await db.doc.create('Opportunity', {
  Name: 'ACME Corp - CRM Project',
  AccountId: acmeAccountId,
  Amount: 50000,
  Stage: 'Proposal'
});

// 2. Create quote from opportunity
const quote = await db.doc.create('Quote', {
  OpportunityId: opp.Id,
  AccountId: acmeAccountId,
  ContactId: primaryContactId,
  QuoteName: 'ACME CRM Proposal - 2026',
  ValidUntil: addDays(new Date(), 30),
  Currency: 'USD'
});

// 3. Add products using AI bundle recommendation
const bundleRecommendation = await getAIBundleRecommendations({
  accountId: acmeAccountId,
  budget: 50000,
  industry: opp.Industry
});

// Add recommended bundle
for (const item of bundleRecommendation.items) {
  await db.doc.create('QuoteLineItem', {
    QuoteId: quote.Id,
    ProductId: item.ProductId,
    Quantity: item.Quantity,
    UnitPrice: item.UnitPrice,
    Discount: item.Discount
  });
}

// 4. Apply volume discount pricing rules
const pricingRules = await evaluatePricingRules(quote);
for (const rule of pricingRules) {
  await applyPricingRule(quote.Id, rule);
}

// 5. Calculate totals
const totals = await calculateQuoteTotals(quote.Id);
await db.doc.update('Quote', quote.Id, {
  Subtotal: totals.subtotal,
  TotalDiscount: totals.discount,
  Tax: totals.tax,
  ShippingHandling: totals.shipping,
  GrandTotal: totals.grandTotal
});

// 6. Request discount approval (if needed)
if (quote.Discount > 15) {
  const approval = await db.doc.create('ApprovalRequest', {
    QuoteId: quote.Id,
    RequestedById: salesRepId,
    ApprovalType: 'Discount',
    DiscountRequested: quote.Discount,
    Justification: 'Competitive situation. Customer comparing with Salesforce.',
    ApproverId: salesManagerId
  });
  
  // Wait for approval
  await waitForApproval(approval.Id);
}

// 7. Generate PDF quote
const pdfUrl = await generateQuotePDF(quote.Id);

// 8. Send to customer
await sendQuoteEmail({
  quoteId: quote.Id,
  to: primaryContact.Email,
  subject: 'Your CRM Proposal from HotCRM',
  pdfUrl: pdfUrl
});

// 9. Track customer response
await db.doc.update('Quote', quote.Id, {
  Status: 'Sent',
  SentDate: new Date()
});

// 10. Customer accepts
await db.doc.update('Quote', quote.Id, {
  Status: 'Customer Accepted',
  AcceptedDate: new Date()
});

// 11. Convert to contract
const contract = await convertQuoteToContract(quote.Id);

// 12. Update opportunity
await db.doc.update('Opportunity', opp.Id, {
  Stage: 'Closed Won',
  Amount: quote.GrandTotal,
  CloseDate: new Date()
});
```

## Next Steps

- [Contracts & Payments](/docs/features/contracts-payments) - Convert quotes to contracts
- [Sales Automation](/docs/features/sales-automation) - Link quotes to opportunities
- [Service & Support](/docs/features/service-support) - Support sold products
- [AI Capabilities](/docs/ai/overview) - Deep dive into AI features
